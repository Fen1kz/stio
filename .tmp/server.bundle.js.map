{"version":3,"sources":["webpack:///webpack/bootstrap ac7cb9ef4bbc2ae54938","webpack:///./client/actions/act-client-auth.js","webpack:///./client/actions/act-client-game-controls.js","webpack:///./client/actions/act-client-game.js","webpack:///./client/actions/act-client-sockets.js","webpack:///./client/actions/index.js","webpack:///./client/models/game/ClientGameModel.js","webpack:///./client/models/game/manage/InputManager.js","webpack:///./client/reducers/index.js","webpack:///./client/reducers/rd-client-app.js","webpack:///./client/reducers/rd-client-game.js","webpack:///./client/reducers/rd-client-socket.js","webpack:///./client/reducers/rd-client-user.js","webpack:///./client/store/apiMiddleware.js","webpack:///./client/store/createStore.js","webpack:///./client/store/historyMiddleware.js","webpack:///./client/store/questionMiddleware.js","webpack:///./client/store/socketMiddleware.js","webpack:///./server/actions/act-server-games.js","webpack:///./server/actions/act-server-sockets.js","webpack:///./server/actions/act-server-users.js","webpack:///./server/actions/index.js","webpack:///./server/models/game/ServerGameModel.js","webpack:///./server/reducers/index.js","webpack:///./server/reducers/rd-server-games.js","webpack:///./server/reducers/rd-server-sockets.js","webpack:///./server/store/createStore.js","webpack:///./server/store/questionMiddleware.js","webpack:///./server/store/socketMiddleware.js","webpack:///./shared/actions/act-shared-games.js","webpack:///./shared/actions/act-shared-questions.js","webpack:///./shared/actions/act-shared-sockets.js","webpack:///./shared/actions/act-shared-users.js","webpack:///./shared/actions/index.js","webpack:///./shared/models/UserModel.js","webpack:///./shared/models/game/GameAction.js","webpack:///./shared/models/game/GameModel.js","webpack:///./shared/models/game/GameState.js","webpack:///./shared/models/game/UnitModel.js","webpack:///./shared/models/geom/Point.js","webpack:///./shared/utils/redux.js","webpack:///./test/setup/index.js","webpack:///./test/setup/local-storage-mock.js","webpack:///./test/test-entry.js","webpack:///external \"immutable\"","webpack:///external \"reselect\"","webpack:///external \"socket.io\"","webpack:///external \"ws\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"redux\"","webpack:///external \"redux-immutable\"","webpack:///external \"redux-thunk\"","webpack:///external \"socket.io-client\"","webpack:///external \"uuid\"","webpack:///external \"babel-polyfill\"","webpack:///external \"history/createMemoryHistory\""],"names":["authLoginRequest","login","type","data","meta","api","method","authLoginSuccess","user","client$authLoginRequest","dispatch","then","catch","e","console","log","gameClientInput","inputPack","socket","client$gameClientInput","getState","actions","length","client$gameInit","client$socketConnect","path","transports","on","emit","action","client$socketDisconnect","disconnect","client$socketEmit","coreError","historyPush","getTimestamp","window","performance","now","prediction","ClientGameModel","onFrame","timeNow","timeDelta","timeLast","step","update","render","requestFrame","onState","delta","withMutations","game","inputs","filter","timestamp","state","merge","fn","requestAnimationFrame","input","start","dt","reduce","inputAction","updateFn","subjectId","value","INPUT_FPS_SEND","INPUT_FPS_SEND_TIMEOUT","InputManager","onKeyDown","keyCode","controls","space","left","up","right","down","onKeyUp","sendInput","Date","sendFn","compressInput","result","lastTimestamp","document","addEventListener","removeEventListener","control","hasOwnProperty","push","app","updateIn","gameClientProcess","raw","concat","gameClientSend","gameStateUpdateIter","gameStateUpdateSync","gameState","getSocket","get","getSocketStatus","getIn","socketConnect","socketDisconnect","getUserToken","storage","sessionStorage","saveState","setItem","JSON","stringify","loadState","parse","getItem","fetch","body","headers","response","json","next","ClientRecord","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","history","store","require","default","module","hot","accept","replaceReducer","askQuestion","questionsStorage","questionId","Math","floor","random","Promise","resolve","Error","answerQuestion","questionAction","socketId","utilQuestionToClient","utilQuestionToServer","utilAnswerToClient","server","server$gameCreate","create","server$gameJoin","jwtVerifyFails","token","verify","process","env","JWT_SECRET","error","reportError","server$socketConnect","id","reject","tokenValidationError","incomingAction","callback","socketsClientToServer","socketLogin","server$userLogin","new","userId","clientToServer","Object","assign","ServerGameModel","sockets","getGame","gameActions","Type","UNIT_CREATE","unit","setIn","gameCreate","set","gameCommand","gameId","command","remove","ServerRecord","questionActionFn","utilAnswerToServer","gameJoin","gameLeave","utilQuestionType","userLogin","userLogout","to$server","UserModel","v4","GameAction","UNIT_LOC_SET","Input","MakeInput","UNIT_LOC_ADD","InputAction","MakeDelta","x","y","mergeIn","hrtime","GameModel","stepFPS","GameState","units","UnitModel","loc","rot","Point","createReducer","initialState","reducerMap","reducer","global","localStorage","WebSocket","storageMock","key","removeItem","keys","i","SOCKET_URL","createServer","serverStore","serverSocket","serveClient","serverPromise","createClient","clientSocket","sign","describe","timeout","it","args","setTimeout"],"mappings":"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","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ac7cb9ef4bbc2ae54938","import {coreError, historyPush} from './index';\r\n\r\nconst authLoginRequest = (login) => ({\r\n  type: 'authLoginRequest'\r\n  , data: {login}\r\n  , meta: {api: 'login', method: 'POST'}\r\n});\r\n\r\nexport const authLoginSuccess = (user) => ({\r\n  type: 'authLoginSuccess'\r\n  , data: {user}\r\n});\r\n\r\nexport const client$authLoginRequest = (login) => (dispatch) => {\r\n  dispatch(authLoginRequest(login))\r\n    .then((data) => {\r\n      dispatch(authLoginSuccess(data));\r\n      dispatch(historyPush('/game'))\r\n    })\r\n    .catch((e) => {\r\n      console.log(e);\r\n      dispatch(coreError(e))\r\n    })\r\n};\n\n\n// WEBPACK FOOTER //\n// ./client/actions/act-client-auth.js","export const gameClientInput = (inputPack) => ({\r\n  type: 'gameClientInput'\r\n  , data: {inputPack}\r\n  , meta: {socket: true}\r\n});\r\n\r\nexport const client$gameClientInput = (inputPack) => (dispatch, getState) => {\r\n  if (inputPack.actions.length > 0) {\r\n    console.log('client$gameClientInput', inputPack);\r\n    dispatch(gameClientInput(inputPack))\r\n  }\r\n};\n\n\n// WEBPACK FOOTER //\n// ./client/actions/act-client-game-controls.js","import ClientGameModel from '../models/game/ClientGameModel';\r\n\r\nexport const client$gameInit = () => (dispatch, getState) => {\r\n  // const game = getState().game;\r\n  // console.log('game', game);\r\n  // game.start();\r\n  // let prevTime = Date.now();\r\n  // window.requestAnimationFrame(game.onFrame)\r\n  // const game = new ClientGameModel();\r\n  // game.start()\r\n};\n\n\n// WEBPACK FOOTER //\n// ./client/actions/act-client-game.js","import io from 'socket.io-client';\r\n\r\nimport {client$gameInit} from '../actions';\r\nimport {socketConnect, socketDisconnect, utilQuestionToServer} from '../../shared/actions';\r\n\r\nimport {getSocket} from '../reducers/rd-client-socket'\r\nimport {getUserToken} from '../reducers/rd-client-user'\r\n\r\nexport const client$socketConnect = (socket) => (dispatch, getState) => {\r\n  if (!socket) socket = io({\r\n    path: '/api/socket-io'\r\n    , transports: ['websocket']\r\n  });\r\n  // if (!socket) socket = io('http://localhost:5000', {\r\n  //   transports: ['websocket']\r\n  // });\r\n  socket.on('connect', () => {\r\n    socket.emit('login:request', getUserToken(getState()));\r\n  });\r\n  socket.on('disconnect', () => {\r\n    dispatch(socketDisconnect());\r\n  });\r\n  socket.on('login:success', () => {\r\n    dispatch(socketConnect(socket));\r\n    // dispatch(client$gameInit());\r\n    socket.on('action', (action) => {\r\n      dispatch(action);\r\n    });\r\n  });\r\n};\r\n\r\nexport const client$socketDisconnect = () => (dispatch, getState) => {\r\n  const socket = getSocket(getState());\r\n  socket.disconnect();\r\n};\r\n\r\nexport const client$socketEmit = (action) => (dispatch, getState) => {\r\n  const socket = getSocket(getState());\r\n  socket.emit('action', action);\r\n};\n\n\n// WEBPACK FOOTER //\n// ./client/actions/act-client-sockets.js","export const coreError = (e) => ({\r\n  type: 'coreError'\r\n  , data: e\r\n});\r\n\r\nexport const historyPush = (path) => ({\r\n  type: '@@historyMiddleware/push'\r\n  , data: path\r\n});\r\n\r\nexport * from './act-client-sockets';\r\nexport * from './act-client-auth';\r\nexport * from './act-client-game';\r\nexport * from './act-client-game-controls';\n\n\n// WEBPACK FOOTER //\n// ./client/actions/index.js","import {List} from 'immutable';\r\n\r\nimport GameModel from '../../../shared/models/game/GameModel';\r\nimport GameState from '../../../shared/models/game/GameState';\r\nimport GameAction from '../../../shared/models/game/GameAction';\r\nimport InputManager from './manage/InputManager';\r\n\r\nconst getTimestamp = () => window.performance.now();\r\nconst prediction = true;\r\n\r\nexport default class ClientGameModel {\r\n  constructor() {\r\n    this.step = 1e3 / 60;\r\n    this.timeLast = getTimestamp();\r\n    this.requestFrame = (fn) => window.requestAnimationFrame(fn);\r\n  }\r\n\r\n  start() {\r\n    this.input = new InputManager();\r\n    this.input.start(() => 0);\r\n    this.requestFrame(this.onFrame);\r\n  }\r\n\r\n  onFrame = () => {\r\n    const timeNow = getTimestamp();\r\n    this.timeDelta = timeNow - this.timeLast;\r\n    while (this.timeDelta > this.step) {\r\n      this.timeDelta -= this.step;\r\n      this.update(this.step);\r\n    }\r\n    this.render(this.timeDelta);\r\n    this.timeLast = timeNow;\r\n    this.requestFrame(this.onFrame);\r\n  };\r\n\r\n  update(dt) {\r\n    this.input.update(dt);\r\n  }\r\n\r\n  render(dt) {\r\n  }\r\n\r\n  // onFrame = (dt) => this.withMutations(game => {\r\n  //   if (prediction) {\r\n  //     const clientDelta = this.processInputs();\r\n  //     game.merge('state', clientDelta);\r\n  //   }\r\n  // });\r\n\r\n  onState = (delta) => this.withMutations(game => {\r\n    game.update('inputs', inputs => inputs.filter(inputPack => inputPack.timestamp > delta.timestamp));\r\n    game.update('state', state => state.merge(delta));\r\n  });\r\n\r\n  processInputs() {\r\n    return this.inputs.reduce((delta, inputAction) => {\r\n      const updateFn = GameAction[inputAction.type];\r\n      return updateFn(delta, inputAction.subjectId, inputAction.value);\r\n    }, new GameState())\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/models/game/ClientGameModel.js","const INPUT_FPS_SEND = 1;\r\nconst INPUT_FPS_SEND_TIMEOUT = 1e3 / INPUT_FPS_SEND;\r\n\r\nconst getTimestamp = () => window.performance.now();\r\n\r\nexport default class InputManager {\r\n  constructor() {\r\n    this.controls = {\r\n      up: false\r\n      , down: false\r\n      , left: false\r\n      , right: false\r\n      , space: false\r\n    };\r\n\r\n    this.lastTimestamp = getTimestamp();\r\n\r\n    this.actions = [];\r\n  }\r\n\r\n  start(sendFn) {\r\n    this.sendFn = sendFn;\r\n    document.addEventListener('keydown', this.onKeyDown);\r\n    document.addEventListener('keyup', this.onKeyUp);\r\n  }\r\n\r\n  stop() {\r\n    document.removeEventListener('keydown', this.onKeyDown);\r\n    document.removeEventListener('keyup', this.onKeyUp);\r\n  }\r\n\r\n  onKeyDown = (e) => {\r\n    if (e.keyCode === 32) this.controls.space = true;\r\n    else if (e.keyCode === 37) this.controls.left = true;\r\n    else if (e.keyCode === 38) this.controls.up = true;\r\n    else if (e.keyCode === 39) this.controls.right = true;\r\n    else if (e.keyCode === 40) this.controls.down = true;\r\n  };\r\n\r\n  onKeyUp = (e) => {\r\n    if (e.keyCode === 32) this.controls.space = false;\r\n    else if (e.keyCode === 37) this.controls.left = false;\r\n    else if (e.keyCode === 38) this.controls.up = false;\r\n    else if (e.keyCode === 39) this.controls.right = false;\r\n    else if (e.keyCode === 40) this.controls.down = false;\r\n  };\r\n\r\n  update(dt) {\r\n    for (let control in this.controls) {\r\n      if (this.controls.hasOwnProperty(control) && this.controls[control]) {\r\n        this.actions.push(control);\r\n      }\r\n    }\r\n    const timestamp = getTimestamp();\r\n    if (timestamp - this.lastTimestamp > INPUT_FPS_SEND_TIMEOUT) {\r\n      this.sendInput();\r\n      this.lastTimestamp = timestamp;\r\n    }\r\n  }\r\n\r\n  sendInput = () => {\r\n    if (this.actions.length > 0) {\r\n      const input = {timestamp: Date.now(), actions: this.actions};\r\n      this.actions = [];\r\n      this.sendFn(input);\r\n    }\r\n  };\r\n\r\n  compressInput = (actions) => {\r\n    return actions.reduce((result, action) => {\r\n      // const nextAction =\r\n      switch (action) {\r\n      }\r\n      return result;\r\n    }, [])\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/models/game/manage/InputManager.js","import {Map} from 'immutable';\r\nimport {combineReducers} from 'redux-immutable'\r\n\r\nimport app from './rd-client-app';\r\nimport socket from './rd-client-socket';\r\nimport game from './rd-client-game';\r\nimport user from './rd-client-user';\r\n\r\nexport default combineReducers({\r\n  app\r\n  , user\r\n  , socket\r\n  , game\r\n  // , routing: routerReducer\r\n});\n\n\n// WEBPACK FOOTER //\n// ./client/reducers/index.js","import {Map} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\n\r\nexport default createReducer(Map(), {\r\n});\n\n\n// WEBPACK FOOTER //\n// ./client/reducers/rd-client-app.js","import {List, Map, Record} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\nimport {createSelector} from 'reselect';\r\n\r\nimport ClientGameModel from '../models/game/ClientGameModel';\r\n\r\nexport default createReducer(new ClientGameModel(), {\r\n  gameClientInput: (state, {inputPack}) => state.updateIn(['inputs'], (inputs = List()) => inputs.push(inputPack))\r\n  , gameClientProcess: (state, {}) => state.update('raw', raw => raw.concat(inputPack))\r\n  , gameClientSend: (state, {}) => state.update('raw', raw => raw.concat(inputPack))\r\n  , gameStateUpdateIter: (state, {}) => state.update('raw', raw => raw.concat(inputPack))\r\n  , gameStateUpdateSync: (state, {gameState}) => gameState\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./client/reducers/rd-client-game.js","import {Map} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\nimport {createSelector} from 'reselect';\r\n\r\nexport const getSocket = state => state.get('socket');\r\nexport const getSocketStatus = state => state.getIn(['socket', 'status']);\r\n\r\n\r\nexport default createReducer(null, {\r\n  socketConnect: (state, {socket}) => socket\r\n  , socketDisconnect: (state) => null\r\n});\n\n\n// WEBPACK FOOTER //\n// ./client/reducers/rd-client-socket.js","import {Map} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\n\r\nexport const getUserToken = (state) => state.getIn(['user', 'token']);\r\n\r\nconst storage = window.sessionStorage;\r\n\r\nconst saveState = (state) => {\r\n  storage.setItem('user', JSON.stringify(state));\r\n  return state;\r\n};\r\n\r\nconst loadState = () => Map(JSON.parse(storage.getItem('user') || '{}'));\r\n\r\nexport default createReducer(loadState(), {\r\n  authLoginSuccess: (state, {user}) => saveState(Map(user))\r\n});\n\n\n// WEBPACK FOOTER //\n// ./client/reducers/rd-client-user.js","export default () => store => next => action => {\r\n  if (action && action.meta && action.meta.api) {\r\n    return fetch('/api/' + action.meta.api, {\r\n      method: action.meta.method || 'GET'\r\n      , body: JSON.stringify(action.data)\r\n      , headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',\r\n      }\r\n    })\r\n      .then(response => response.json())\r\n  }\r\n  return next(action);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/store/apiMiddleware.js","import {Record} from 'immutable';\r\nimport {createStore, combineReducers, compose, applyMiddleware} from 'redux'\r\n\r\n// Basic Middleware\r\nimport thunk from 'redux-thunk';\r\n\r\nimport apiMiddleware from './apiMiddleware';\r\nimport socketMiddleware from './socketMiddleware';\r\nimport questionMiddleware from './questionMiddleware';\r\n\r\n// History\r\nimport historyMiddleware from './historyMiddleware';\r\n\r\nclass ClientRecord extends Record({\r\n  app: void 0\r\n  // , error: void 0\r\n  , socket: void 0\r\n  , user: void 0\r\n  , game: void 0\r\n}) {\r\n}\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport default (history) => {\r\n  const store = createStore(\r\n    require('../reducers').default\r\n    , new ClientRecord()\r\n    , composeEnhancers(applyMiddleware(\r\n      thunk\r\n      , apiMiddleware()\r\n      , questionMiddleware()\r\n      , socketMiddleware()\r\n      , historyMiddleware(history)\r\n    ))\r\n  );\r\n\r\n  if (module.hot) {\r\n    // Enable Webpack hot module replacement for reducers\r\n    module.hot.accept('../reducers', () => {\r\n      store.replaceReducer(require('../reducers').default);\r\n    });\r\n  }\r\n\r\n  return store;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/store/createStore.js","export default history => store => next => action => {\r\n  if (action.type === '@@historyMiddleware/push') {\r\n    history.push(action.data)\r\n  }\r\n  return next(action);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/store/historyMiddleware.js","import {utilQuestionType, utilAnswerToClient} from '../../shared/actions/act-shared-questions';\r\n\r\nexport const askQuestion = (questionsStorage, action, next) => {\r\n  const questionId = Math.floor(Math.random() * 0x100000);\r\n  action.data.questionId = questionId;\r\n  return new Promise((resolve) => {\r\n    if (!!questionsStorage[questionId]) throw new Error('questionMiddleware');\r\n    questionsStorage[questionId] = resolve;\r\n    next(action);\r\n  });\r\n};\r\n\r\nexport const answerQuestion = (action, dispatch) => {\r\n  const {questionId, questionAction} = action.data;\r\n  const {socketId} = action.meta.socketId;\r\n  return Promise.resolve(dispatch(questionAction))\r\n    .then((data) => {\r\n      dispatch(utilAnswerToClient(questionId, data, socketId))\r\n    });\r\n};\r\n\r\nexport default (questionsStorage = {}) => store => next => action => {\r\n  if (action.type === utilQuestionType.utilQuestionToClient) {\r\n    throw new Error('NYI')\r\n    // return answerQuestion(action, store.dispatch)\r\n  } else if (action.type === utilQuestionType.utilQuestionToServer) {\r\n    return askQuestion(questionsStorage, action, next);\r\n  } else if (action.type === utilQuestionType.utilAnswerToClient) {\r\n    const {questionId} = action.data;\r\n    if (questionsStorage[questionId]) {\r\n      const resolve = questionsStorage[questionId];\r\n      questionsStorage[questionId] = null;\r\n      resolve(action.data);\r\n    } else {\r\n      next(action.data.action);\r\n    }\r\n  } else {\r\n    return next(action);\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/store/questionMiddleware.js","import {getSocket} from '../reducers/rd-client-socket'\r\n\r\nexport default () => store => next => action => {\r\n  // console.log('socketMiddleware', action);\r\n  if (action.meta) {\r\n    const socket = action.meta.socket || getSocket(store.getState());\r\n    if (!!socket && action.meta.server) {\r\n      action.meta = null;\r\n      socket.emit('action', action);\r\n    }\r\n  }\r\n  return next(action);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/store/socketMiddleware.js","import ServerGameModel from '../models/game/ServerGameModel';\r\nimport UnitModel from '../../shared/models/game/UnitModel';\r\nimport GameAction from '../../shared/models/game/GameAction';\r\n\r\nimport {userLogin} from '../../shared/actions'\r\n\r\n\r\nexport const server$gameCreate = () => (dispatch, getState) => {\r\n  const game = ServerGameModel.create();\r\n};\r\n\r\nexport const server$gameJoin = () => (dispatch, getState) => {\r\n  // dispatch(new GameAction);\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/actions/act-server-games.js","import {socketConnect, socketDisconnect} from '../../shared/actions';\r\n\r\nimport {clientToServer, server$userLogin} from '../actions';\r\n\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst jwtVerifyFails = (token) => {\r\n  try {\r\n    jwt.verify(token, process.env.JWT_SECRET);\r\n    return false;\r\n  } catch (e) {\r\n    console.error(e);\r\n    return e;\r\n  }\r\n};\r\n\r\nconst reportError = (e) => {\r\n  console.error(e);\r\n};\r\n\r\nexport const server$socketConnect = (socket) => (dispatch, getState) => {\r\n  const socketId = socket.id;\r\n  return new Promise((resolve, reject) => {\r\n    socket.on('login:request', (token) => {\r\n      const tokenValidationError = jwtVerifyFails(token);\r\n      if (tokenValidationError) {\r\n        reportError(tokenValidationError);\r\n        reject(tokenValidationError);\r\n        return;\r\n      }\r\n      socket.on('action', (incomingAction, callback) => {\r\n        const action = {\r\n          type: incomingAction.type\r\n          , data: incomingAction.data\r\n          , meta: {socketId}\r\n        };\r\n        if (!clientToServer[action.type]) {\r\n          reportError(new Error(`No clientToServer[${action.type}]`));\r\n          // if (callback) callback(false);\r\n          return;\r\n        }\r\n        const result = dispatch(clientToServer[action.type](action.data, action.meta));\r\n        if (!!callback) {\r\n          if (result instanceof Promise) {\r\n            result.then(callback);\r\n          } else {\r\n            callback();\r\n          }\r\n        }\r\n      });\r\n      dispatch(socketConnect(socket));\r\n      dispatch(server$userLogin(socket.id));\r\n      socket.emit('login:success', true);\r\n      resolve();\r\n    });\r\n    socket.on('disconnect', () => {\r\n      dispatch(socketDisconnect(socketId));\r\n    });\r\n  });\r\n};\r\n\r\nexport const socketsClientToServer = {\r\n  socketLogin: (data) => (dispatch) => {\r\n    console.log('SOCKET LOGIN!', data);\r\n    return 'hey!'\r\n  }\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/actions/act-server-sockets.js","import UserModel from '../../shared/models/UserModel';\r\n\r\n\r\nimport {userLogin} from '../../shared/actions'\r\nimport {server$gameCreate, server$gameJoin} from '../actions'\r\n\r\nimport {getGame} from '../reducers/rd-server-games';\r\n\r\nexport const server$userLogin = () => (dispatch, getState) => {\r\n  const user = UserModel.new();\r\n  const userId = user.id;\r\n  dispatch(userLogin(user));\r\n\r\n  if (!getGame(getState(), null)) {\r\n    dispatch(server$gameCreate())\r\n  }\r\n\r\n  dispatch(server$gameJoin(null, userId));\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/actions/act-server-users.js","export * from './act-server-sockets';\r\nexport * from './act-server-users';\r\nexport * from './act-server-games';\r\n\r\nimport {utilQuestionType, utilQuestionToServer} from '../../shared/actions/act-shared-questions';\r\nimport {socketsClientToServer} from './act-server-sockets';\r\n\r\nexport const clientToServer = Object.assign({}\r\n  , socketsClientToServer\r\n  , {\r\n    [utilQuestionType.utilQuestionToServer]: (data, meta) => utilQuestionToServer({\r\n      type: utilQuestionType.utilQuestionToServer\r\n      , data\r\n      , meta\r\n    })\r\n  }\r\n);\n\n\n// WEBPACK FOOTER //\n// ./server/actions/index.js","import GameModel from '../../../shared/models/game/GameModel';\r\nimport GameState from '../../../shared/models/game/GameState';\r\n\r\nexport default class ServerGameModel extends GameModel {\r\n  static create = () => new ServerGameModel();\r\n\r\n  update(dt) {\r\n    console.log('update', dt);\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/models/game/ServerGameModel.js","import {Map} from 'immutable';\r\nimport {combineReducers} from 'redux-immutable'\r\n\r\nimport sockets from './rd-server-sockets';\r\n\r\nexport default combineReducers({\r\n  sockets\r\n  // , routing: routerReducer\r\n});\n\n\n// WEBPACK FOOTER //\n// ./server/reducers/index.js","import {Map} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\nimport GameAction from '../../shared/models/game/GameAction';\r\nimport {createSelector} from 'reselect';\r\n\r\nexport const getGame = (state, id) => state.getIn(['games', id]);\r\n\r\nconst gameActions = {\r\n  [GameAction.Type.UNIT_CREATE]: (state, id, unit) => state.setIn(['units', unit.id], unit)\r\n};\r\n\r\nexport default createReducer(Map(), {\r\n  gameCreate: (state, {game}) => state.set(game.id, game)\r\n  , gameCommand: (state, {gameId, command}) => state.update(gameId, game => gameActions[command](...command))\r\n});\n\n\n// WEBPACK FOOTER //\n// ./server/reducers/rd-server-games.js","import {Map} from 'immutable';\r\nimport {createReducer} from '../../shared/utils/redux';\r\nimport {createSelector} from 'reselect';\r\n\r\nexport const getSocket = (state, id) => state.getIn(['sockets', id]);\r\n\r\n\r\nexport default createReducer(Map(), {\r\n  socketConnect: (state, {socket}) => state\r\n    .set(socket.id, socket)\r\n  , socketDisconnect: (state, {socketId}) => state\r\n    .remove(socketId)\r\n});\n\n\n// WEBPACK FOOTER //\n// ./server/reducers/rd-server-sockets.js","import {Record} from 'immutable';\r\nimport {createStore, compose, applyMiddleware} from 'redux'\r\n\r\n// Basic Middleware\r\nimport thunk from 'redux-thunk';\r\n\r\nimport socketMiddleware from './socketMiddleware';\r\nimport questionMiddleware from './questionMiddleware';\r\n\r\nconst ServerRecord = Record({\r\n  sockets: void 0\r\n}, 'ServerRecord');\r\n\r\nexport default () => {\r\n  const store = createStore(\r\n    require('../reducers').default\r\n    , new ServerRecord()\r\n    , compose(applyMiddleware(\r\n      thunk\r\n      , socketMiddleware()\r\n      , questionMiddleware()\r\n    ))\r\n  );\r\n\r\n  if (module.hot) {\r\n    // Enable Webpack hot module replacement for reducers\r\n    module.hot.accept('../reducers', () => {\r\n      store.replaceReducer(require('../reducers').default);\r\n    });\r\n  }\r\n\r\n  return store;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/store/createStore.js","import {utilQuestionType, utilAnswerToClient} from '../../shared/actions/act-shared-questions';\r\nimport {clientToServer} from '../actions';\r\n\r\nexport const askQuestion = (questionsStorage, action, next) => {\r\n  const questionId = Math.floor(Math.random() * 0x100000);\r\n  action.data.questionId = questionId;\r\n  return new Promise((resolve) => {\r\n    if (!!questionsStorage[questionId]) throw new Error('questionMiddleware');\r\n    questionsStorage[questionId] = resolve;\r\n    next(action);\r\n  });\r\n};\r\n\r\nexport const answerQuestion = (action, dispatch) => {\r\n  const {questionId, questionAction} = action.data;\r\n  const {socketId} = action.meta;\r\n  console.log('answerQuestion', questionAction);\r\n  const questionActionFn = clientToServer[questionAction.type];\r\n  if (questionActionFn) {\r\n    return Promise.resolve(dispatch(questionActionFn(questionAction.data, action.meta)))\r\n      .then((data) => {\r\n        console.log('answerQuestion data', questionId, data, socketId);\r\n        dispatch(utilAnswerToClient(questionId, data, socketId))\r\n      });\r\n  }\r\n};\r\n\r\nexport default (questionsStorage = {}) => store => next => action => {\r\n  if (action.type === utilQuestionType.utilQuestionToClient) {\r\n    throw new Error('NYI')\r\n    // return askQuestion(questionsStorage, action, next);\r\n  } else if (action.type === utilQuestionType.utilQuestionToServer) {\r\n    return answerQuestion(action, store.dispatch)\r\n  } else if (action.type === utilQuestionType.utilAnswerToServer) {\r\n    const {questionId} = action.data;\r\n    if (questionsStorage[questionId]) {\r\n      const resolve = questionsStorage[questionId];\r\n      questionsStorage[questionId] = null;\r\n      resolve(action.data);\r\n    } else {\r\n      next(action.data.action);\r\n    }\r\n  } else {\r\n    return next(action);\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/store/questionMiddleware.js","import {getSocket} from '../reducers/rd-server-sockets'\r\n\r\nexport default () => store => next => action => {\r\n  if (action.meta) {\r\n    const socketId = action.meta.socketId;\r\n    if (socketId) {\r\n      const socket = getSocket(store.getState(), socketId);\r\n      if (!!socket) {\r\n        socket.emit('action', action);\r\n      }\r\n    }\r\n  }\r\n  next(action);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/store/socketMiddleware.js","export const gameCreate = (game) => ({\r\n  type: 'gameCreate'\r\n  , data: {game}\r\n});\r\n\r\nexport const gameJoin = (gameId, userId) => ({\r\n  type: 'gameJoin'\r\n  , data: {gameId, userId}\r\n});\r\n\r\nexport const gameLeave = (gameId, userId) => ({\r\n  type: 'gameLeave'\r\n  , data: {gameId, userId}\r\n});\n\n\n// WEBPACK FOOTER //\n// ./shared/actions/act-shared-games.js","import {to$server} from '../actions';\r\n\r\nexport const utilQuestionType = {\r\n  utilQuestionToClient: '@@questionMiddleware/utilQuestion/toClient'\r\n  , utilAnswerToClient: '@@questionMiddleware/utilAnswer/toClient'\r\n  , utilQuestionToServer: '@@questionMiddleware/utilQuestion/toServer'\r\n  , utilAnswerToServer: '@@questionMiddleware/utilAnswer/toServer'\r\n};\r\n\r\n// Server\r\n\r\nexport const utilQuestionToClient = (questionAction) => ({\r\n  type: utilQuestionType.utilQuestionToClient\r\n  , data: {questionAction}\r\n  , meta: {}\r\n});\r\n\r\nexport const utilAnswerToClient = (id, data, socketId) => ({\r\n  type: utilQuestionType.utilAnswerToClient\r\n  , data: {id, data}\r\n  , meta: {socketId}\r\n});\r\n\r\n// Client\r\n\r\nexport const utilQuestionToServer = (questionAction, socket) => ({\r\n  type: utilQuestionType.utilQuestionToServer\r\n  , data: {questionAction}\r\n  , meta: {socket, server: true}\r\n});\r\n\r\nexport const utilAnswerToServer = (id, data) => ({\r\n  type: utilQuestionType.utilAnswerToServer\r\n  , data: {id, data}\r\n  , meta: {server: true}\r\n});\n\n\n// WEBPACK FOOTER //\n// ./shared/actions/act-shared-questions.js","export const socketConnect = (socket) => ({\r\n  type: 'socketConnect'\r\n  , data: {socket}\r\n});\r\n\r\nexport const socketDisconnect = (socketId) => ({\r\n  type: 'socketDisconnect'\r\n  , data: {socketId}\r\n});\n\n\n// WEBPACK FOOTER //\n// ./shared/actions/act-shared-sockets.js","export const userLogin = (user) => ({\r\n  type: 'userLogin'\r\n  , data: {user}\r\n});\r\n\r\nexport const userLogout = (userId) => ({\r\n  type: 'userLogout'\r\n  , data: {userId}\r\n});\n\n\n// WEBPACK FOOTER //\n// ./shared/actions/act-shared-users.js","export const to$server = (action) => {\r\n  action.meta.server = true;\r\n  return action;\r\n};\r\n\r\nexport * from './act-shared-questions';\r\nexport * from './act-shared-sockets';\r\nexport * from './act-shared-users';\r\nexport * from './act-shared-games';\n\n\n// WEBPACK FOOTER //\n// ./shared/actions/index.js","import {Record, Map} from 'immutable';\r\nimport uuid from 'uuid';\r\n\r\nexport default class UserModel extends Record({\r\n  id: null\r\n}) {\r\n  static new() {\r\n    return new UserModel({\r\n      id: uuid.v4()\r\n    });\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/models/UserModel.js","import {Record, Map} from 'immutable';\r\n\r\nconst GameAction = {};\r\nexport default GameAction;\r\n\r\nGameAction.Type = {\r\n  UNIT_CREATE: 'UNIT_CREATE'\r\n  , UNIT_LOC_SET: 'UNIT_LOC_SET'\r\n};\r\n\r\nGameAction.Input = class InputAction extends Record({\r\n  type: ''\r\n  , subjectId: null\r\n  , value: null\r\n}) {\r\n};\r\n\r\nGameAction.MakeInput = {\r\n  UNIT_LOC_ADD: (subjectId, value) => new InputAction({type: GameAction.Type.UNIT_LOC_ADD, subjectId, value})\r\n};\r\n\r\nGameAction.MakeDelta = {\r\n  UNIT_CREATE: (delta, subjectId, value) => delta.setIn(['units', subjectId, ])\r\n  , UNIT_LOC_ADD: (delta, subjectId, [x, y]) => delta.mergeIn(['units', subjectId, 'loc'], {x, y})\r\n};\n\n\n// WEBPACK FOOTER //\n// ./shared/models/game/GameAction.js","import {List} from 'immutable';\r\n\r\nimport GameState from './GameState';\r\nimport GameAction from './GameAction';\r\n\r\nconst getTimestamp = () => process.hrtime();\r\n\r\n\r\nexport default class GameModel {\r\n  constructor() {\r\n    this.stepFPS = 60;\r\n    this.step = 1e3 / this.stepFPS;\r\n    this.timeLast = getTimestamp();\r\n    this.requestFrame = (fn) => {\r\n      throw new Error('Define requestFrame')\r\n    };\r\n  }\r\n\r\n  start() {\r\n    this.requestFrame(this.onFrame);\r\n  }\r\n\r\n  onFrame = () => {\r\n    const timeNow = getTimestamp();\r\n    this.timeDelta = timeNow - this.timeLast;\r\n    while (this.timeDelta > this.step) {\r\n      this.timeDelta -= this.step;\r\n      this.update(this.step);\r\n    }\r\n    this.render(this.timeDelta);\r\n    this.timeLast = timeNow;\r\n    this.requestFrame(this.onFrame);\r\n  };\r\n\r\n  update(dt) {\r\n  }\r\n\r\n  render(dt) {\r\n  }\r\n\r\n  // onState = (delta) => this.withMutations(game => {\r\n  //   game.update('inputs', inputs => inputs.filter(inputPack => inputPack.timestamp > delta.timestamp));\r\n  //   game.update('state', state => state.merge(delta));\r\n  // });\r\n\r\n  // processInputs() {\r\n  //   return this.inputs.reduce((delta, inputAction) => {\r\n  //     const updateFn = GameAction[inputAction.type];\r\n  //     return updateFn(delta, inputAction.subjectId, inputAction.value);\r\n  //   }, new GameState())\r\n  // }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/models/game/GameModel.js","import {Record, Map} from 'immutable';\r\n\r\nexport default class GameState extends Record({\r\n  units: Map()\r\n}) {\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/models/game/GameState.js","import {Record, Map} from 'immutable';\r\nimport uuid from 'uuid';\r\n\r\nimport Point from '../geom/Point';\r\n\r\nexport default class UnitModel extends Record({\r\n  id: null\r\n  , loc: Point.new()\r\n  , rot: 0\r\n}) {\r\n  static new() {\r\n    return new UnitModel({\r\n      id: uuid.v4()\r\n    });\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/models/game/UnitModel.js","import {Record, Map} from 'immutable';\r\n\r\nexport default class Point extends Record({\r\n  x: 0\r\n  , y: 0\r\n}) {\r\n  static new() {\r\n    return new Point();\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/models/geom/Point.js","export function createReducer(initialState, reducerMap) {\r\n  return (state = initialState, action) => {\r\n    const reducer = reducerMap[action.type];\r\n    return reducer\r\n      ? reducer(state, action.data, action.user)\r\n      : state;\r\n\r\n    // With mutations?\r\n    //if (reducer) {\r\n    //  if (state && state.asMutable) {\r\n    //    const result = reducer(state.asMutable(), action.data, action.user);\r\n    //    if (result) {\r\n    //      return result.asImmutable();\r\n    //    } else {\r\n    //      return null;\r\n    //    }\r\n    //  } else {\r\n    //    return reducer(state, action.data, action.user);\r\n    //  }\r\n    //} else {\r\n    //  return state;\r\n    //}\r\n  };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./shared/utils/redux.js","global.window = {};\r\nwindow.localStorage = require('./local-storage-mock').default();\r\nwindow.sessionStorage = require('./local-storage-mock').default();\r\nglobal.WebSocket = require('ws'); // Hack for https://github.com/socketio/engine.io-client/blob/master/lib/transports/websocket.js#L13\r\nwindow.performance = {\r\n  now: () => process.hrtime()\r\n};\n\n\n// WEBPACK FOOTER //\n// ./test/setup/index.js","export default function storageMock() {\r\n  var storage = {};\r\n\r\n  return {\r\n    setItem: function (key, value) {\r\n      storage[key] = value || '';\r\n    },\r\n    getItem: function (key) {\r\n      return storage[key] || null;\r\n    },\r\n    removeItem: function (key) {\r\n      delete storage[key];\r\n    },\r\n    get length() {\r\n      return Object.keys(storage).length;\r\n    },\r\n    key: function (i) {\r\n      var keys = Object.keys(storage);\r\n      return keys[i] || null;\r\n    }\r\n  };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./test/setup/local-storage-mock.js","import './setup'\r\n\r\nimport ioServer from 'socket.io';\r\nimport ioClient from 'socket.io-client';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nimport createServerStore from '../server/store/createStore';\r\nimport createClientStore from '../client/store/createStore';\r\nimport createHistory from 'history/createMemoryHistory';\r\nimport {server$socketConnect} from '../server/actions';\r\nimport {client$socketConnect, authLoginSuccess} from '../client/actions';\r\n\r\n\r\nconst SOCKET_URL = 'http://localhost:5000';\r\n\r\nexport const createServer = () => {\r\n  const serverStore = createServerStore();\r\n  const serverSocket = ioServer(5000, {\r\n    serveClient: false\r\n    , transports: ['websocket']\r\n  });\r\n  const serverPromise = new Promise((resolve) => {\r\n    serverSocket.on('connection', (socket) => {\r\n      serverStore.dispatch(server$socketConnect(socket))\r\n        .then(resolve);\r\n      socket.on('echo', (data, callback) => {\r\n        console.log('server got echo');\r\n        callback('echo returned')\r\n      })\r\n    });\r\n  });\r\n  return {serverStore, serverPromise}\r\n};\r\n\r\nexport const createClient = () => {\r\n  const store = createClientStore(createHistory());\r\n  const clientSocket = ioClient(SOCKET_URL, {\r\n    'force new connection': true\r\n    , transports: ['websocket']\r\n  });\r\n  store.dispatch(authLoginSuccess({token: jwt.sign({}, process.env.JWT_SECRET)}));\r\n  store.dispatch(client$socketConnect(clientSocket));\r\n  return clientSocket;\r\n};\r\n\r\ndescribe('describe', function () {\r\n  this.timeout(1000000);\r\n  it('it', async () => {\r\n    const {serverStore, serverPromise} = createServer();\r\n    const clientSocket = createClient();\r\n    await new Promise(resolve => clientSocket.on('connect', () => {\r\n      resolve();\r\n    }));\r\n    console.log(serverStore.getState());\r\n    await serverPromise;\r\n    await new Promise(resolve => {\r\n      clientSocket.emit('echo', 'echo', (...args) => {\r\n        console.log('emit', ...args)\r\n        resolve()\r\n      })\r\n    });\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n    console.log(serverStore.getState());\r\n  })\r\n});\n\n\n// WEBPACK FOOTER //\n// ./test/test-entry.js","module.exports = require(\"immutable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"immutable\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"reselect\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"reselect\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"redux-immutable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-immutable\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"redux-thunk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-thunk\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"socket.io-client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io-client\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"history/createMemoryHistory\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"history/createMemoryHistory\"\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}